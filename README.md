                                                Дипломная работа «Облачное хранилище»

                                                     Описание коипонентоа проэкта.


1.  Пакет "model" содержит 3 класса:
  
    
      - класс "User"- содержит поля хранящие в себе данные о пользователе
  уникальный индентификатор, логин, хеш пароля, токен аутефикации и файлы 
  связаные с пользователем.Класс помечен аннотацией "@Entity", что указывает 
  что он является сущьностью и используется для работы с базой данных.
  Клас также помечен аннотацией "@Table(name = "users")" - сущность
  будет связана с таблицей users в базе данных. Поле "Id" помечено аннотацией "Id"
  это указывает ,что поле id является уникальным идентификатором для этой сущности,
  также это поле помечено аннотацией "@GeneratedValue(strategy = GenerationType.IDENTITY)"
  -указывает на то что значение id будет автоматически генерироваться базой данных.
  Список хранящий файлы помечен аннотацией @OneToMany(mappedBy = "user", cascade = CascadeType.ALL)
  это указывает что один пользователь может иметь множество файлов.Связь управляется полем 
  "user" в классе FileEntity (при удалении пользователя будут удалены все файлы связанные с ним)


      - класс "FileEntity" - предназначен для управления файлами, загруженными пользователями,
   и позволяет хранить и извлекать информацию о каждом файле, включая его имя, размер и путь.
   Класс помечен аннотацией "@Entity", что указывает что он является сущьностью и будет отображаться
   в базе данныхданных.Класс содержит поля хранящие в себе имя файла, размер файла, путь к файлу, 
   экземпляр обьекта "User" для связи с пользователем. Поле "Id" помечено  аннотацией "Id" это
   указывает ,ччто это поле является первичным ключом, также это поле помечено аннотацией 
   "@GeneratedValue(strategy = GenerationType.IDENTITY)" -указывает на то что  значение id будет 
   автоматически генерироваться базой данных. Аннотация @ManyToOne указывает, что каждый файл может 
   принадлежать только одному пользователю, но один пользователь может иметь множество файлов.
   Экземпляр класса "User" помечен аннотациями  @JoinColumn(name = "userId", nullable = false) указывает,
   что в таблице FileEntity будет внешний ключ userId, который ссылается на идентификатор пользователя, 
   поле не может быть пустым (nullable = false).

  
      - класс "ErrorResponse" - предназначен для упрощения обработки ошибок, предоставляя все необходимые 
   данные для диагностики и устранения проблем. Он используется, чтобы структурировать и отправить клиенту
   детальную информацию о произошедшей ошибке в формате, который легко обрабатывается. Содержит поля для 
   хранения времени и даты, статуса ошибки,сообщение об ошибке, детальное сообщение о типе ошибки, пкть
   к ресурсу который вызвал ошибку. 

   
2.  Пакет "repository" содержит 2 интерфейса:
  

      - интерфейс "FileRepository" - расширяет функциональность JpaRepository, предоставляя методы для
    работы с сущностью FileEntity. Интерфейс помечен аннотацией "@Repository" - указывает, что данный
    интерфейс является компонентом репозитория, который отвечает за взаимодействие с базой данных. Интерфейс
    является наследником "JpaRepository". JpaRepository предоставляет стандартные методы создание, чтение,
    обновление, удаление над сущностью FileEntity. Параметры <FileEntity, Long> указывают, что репозиторий 
    будет работать с сущностью FileEntity, а тип идентификатора этой сущности — Long. Интерфейс предоставляет 
    метод "findByFilenameAndUser" для поиска файла по имени и пользователю. Возвращает Optional<FileEntity>, 
    что позволяет избежать NullPointerException, если файл не найден. Также предоставляет метод "findByUserId"
    ля получения списка файлов, принадлежащих пользователю с указанным идентификатором. Возвращает список 
    объектов FileEntity.


      - интерфейс "UserRepository" отличается от предыдущего интерфейса только тем, что предоставляет другие
    методы для выполнения операций поиска, что упрощает взаимодействие с базой данных. Метод "findByLogin" для
    поиска пользователя по его логину. Возвращает объект Optional, который может содержать найденного пользователя
    или быть пустым, если пользователь с таким логином не найден. Метод "findByAuthToken" для поиска пользователя
    по его токену аутентификации. Также возвращает объект Optional, что позволяет безопасно обрабатывать случаи,
    когда пользователь с указанным токеном не найден.

    
3.  Пакет "exeption" содержит 4 класса:
  
    
      - класс "FileNotFoundException" представляет собой пользовательское исключение, которое наследуется от класса
    RuntimeException. Его основное предназначение — сигнализировать о том, что запрашиваемый файл не был найден в 
    системе. Класс "FileNotFoundException" наследует "RuntimeException" - позволяет выбрасывать это исключение без
    необходимости обрабатывать его в блоке try-catch в каждом месте вызова.Использование пользовательского исключения
    позволяет в дальнейшем вводить более конкретные обработчики для управления ситуациями, связанными с отсутствием 
    файла, не смешивая их с другими типами исключений. Конструктор класса принимает строковый параметр message, 
    который представляет собой сообщение об ошибке.

    
      - класс "InvalidCredentialsException" отличается от предыдущего класса только назначением.Класс используется
    для сигнализации о проблемах с аутентификацией пользователя, таких как неправильный логин или пароль. Это позволяет
    более точно обрабатывать ошибки, связанные с аутентификацией, и предоставлять пользователям соответствующие
    сообщения об ошибках.

    
      - класс "UserNotFoundException" также является пользовательским исключением предназначен сигнализировать когда 
    пользователь не найден в системе. Он также является наследником RuntimeException.Конструктор класса принимает
    строковый параметр message,  который представляет собой сообщение об ошибке.

   
      - класс "GlobalExceptionHandler" обеспечивает централизованное управление исключениями в приложении, улучшая
    обработку ошибок и предоставляя пользователям понятные сообщения об ошибках. Класс помечен аннотацией
    @ControllerAdvice, что позволяет ему перехватывать исключения, возникающие в контроллерах, и обрабатывать их
    централизованно.Класс использует Logger для записи предупреждений и ошибок. В классе прописаны следующие методы:


                метод "handleUserNotFound" для обработки исключений UserNotFoundException, возвращает ответ с кодом
              состояния 404 и сообщением о том, что пользователь не найден.

                метод "handleInvalidCredentials"для обработки исключений InvalidCredentialsException, возвращает 
              ответ с кодом состояния 401 и сообщением о неверных учетных данных.

                метод "handleFileNotFound" для обработкиисключений FileNotFoundException, возвращает ответ с кодом 
              состояния 404 и сообщением о том, что файл не найден.

                метод "handleGeneralException"для обработки всех остальных исключений, возвращает ответ с кодом 
              состояния 500 и сообщением об ошибке.

                метод "createErrorResponse" создает объект ErrorResponse, который содержит информацию об ошибке,
              такую как временная метка, статус, сообщение и путь запроса. Этот метод используется всеми обработчиками 
              исключений для формирования стандартизированного ответа.
  

4.  Пакет "config"  содержит 3 класса:
  
   
       - класс "WebConfig" является конфигурационным классом для настройки веб-приложения на основе Spring. Он помечен
     аннотациями "@Configuration" указывающей, что класс содержит определения бинов и конфигурацию для контекста 
     приложения Spring и аннотацией "@EnableWebMvc" указывающей на поддержку Spring MVC, позволяя использовать
     аннотации контроллеров и другие функции, связанные с веб-разработкой.Класс реализовывает интерфейс "WebMvcConfigurer"
     что позволяет переопределять методы для настройки различных аспектов Spring MVC. Класс позволяет взаимодействовать 
     с сервером, находящимся на другом домене или порту.
              
                метод "addCorsMappings" является переопределенным и осуществляет настройки CORS.
              Позволяет запросы с любого источника (/**),
              разрешает использование куки (allowCredentials(true)),
              указывает разрешенные источники (allowedOrigins("http://localhost:8081"))
              и разрешает определенные HTTP-методы (allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")).


       - класс "SecurityConfig" представляет собой конфигию безопасности веб-приложения на базе Spring Security. Он управляет
     настройками безопасности, такими как аутентификация и авторизация пользователей и является ключевым элементом для
     управления безопасностью в приложении, определяя правила доступа, механизмы шифрования и аутентификацию 
     пользователей. Класс помечен аннотацией "@Configuration" указывающую на то что этот класс содержит конфигурацию бинов. 
     Аннотация "@EnableWebSecurity" включает функциональность безопасности Spring в приложении.Класс содержит следующие 
     методы:   
       
                 метод "securityFilterChain" помечен аннотацией "@Bean", означает что метод возвращает объект 
               который будет использоваться для настройки цепочки фильтров безопасности.
               csrf(AbstractHttpConfigurer::disable) - отключает защиту CSRF для упрощения работы API. 
               requestMatchers("/login", "/logout").permitAll() - разрешает доступ к эндпоинтам для логина и логаута
               без аутентификации.
               requestMatchers(HttpMethod.OPTIONS, "/**").permitAll() - открывает доступ для запросов с методом OPTIONS
               anyRequest().authenticated() - все остальные запросы должны быть аутентифицированы

                 метод "passwordEncoder" возвращает экземпляр BCryptPasswordEncoder, который используется для шифрования 
               паролей пользователя. 

                 метод "authManager" создает и возвращает объект AuthenticationManager, который управляет процессом
               аутентификации пользователей.


      - класс "DataInitializer" реализует интерфейс CommandLineRunner, что позволяет ему выполнять код при запуске 
    приложения Spring. Создает пользователя с заданным логином и паролем, если он еще не существует в базе данных. 
    Помечен аннотацией "@Component" указывает на то что этот класс является компонентом Spring и будет управляться 
    контейнером Spring. Класс позволяет автоматически создавать необходимые данные при его запуске.


                 метод "run" метод выполняется при старте приложения в результате определяется логин и пароль по умолчанию,
               проверяется наличие пользователя в базе данных, если пользователь не найден, создается новый объект User,
               пароль которого хешируется с помощью PasswordEncoder, и сохраняется в репозитории, в консоль выводится 
               сообщение о создании пользователя или о том, что пользователь уже существует.


5.   пакет "controller" содержит 1 класс:


      - класс "FileController" является контроллером в приложении на основе Spring.  отвечает за обработку HTTP-запросов, 
    связанных с аутентификацией пользователей и управлением файлами в облачном хранилище. Класс помечен аннотацией 
    "@RestController" что указывает на то, что он будет обрабатывать RESTful запросы и возвращать данные в формате JSON.
    Также класс помечен аннотацией  @RequestMapping("/cloud") - указывает, что все методы внутри этого класса будут 
    обрабатывать запросы, начинающиеся с пути /cloud. Это позволяет организовать маршрутизацию и группировать связанные 
    эндпоинты. 


                  метод "login" помечен аннотацией "@RequestMapping("login")" - означает что метод будет обрабатывать POST 
                запросы связанные с url "login". Метод принимаетлогин и пароль пользователя в теле запроса, а затем 
                вызывает метод аутентификации из AuthorizationService. Возвращает статус 200 OK и токен аутентификации 
                в виде строки,если аутентификация успешна. 
                 

                  метод "logout" помечен аннотацией @PostMapping("/logout") - означает что метод будет обрабатывать POST 
                запросы связанные с url "logout". Принимает токен аутентификации из заголовка запроса и вызывает метод
                выхода из AuthorizationService. Возвращает статус 200 OK, если выход выполнен успешно.


                  меетод "uploadFile" помечен аннотацией  @PostMapping("/file") - означает что метод будет обрабатывать POST 
                запросы связанные с url "/file". Принимает токен аутентификации, имя файла и сам файл в качестве
                параметров. Вызывает метод загрузки файла из FileService. Возвращает статус 200 OK, если файл загружен 
                успешно.


                  метод "deleteFile" помечен аннотацией @DeleteMapping("/file") - означает что метод будет обрабатывать DELETE
                запросы связанные с url "file". Принимает токен аутентификации и имя файла в качестве параметров. Вызывает 
                метод удаления файла из FileService. Возвращает статус 200 OK, если файл удален  успешно.
               
                
                  метод "downloadFile" помечен аннотацией @GetMapping("/file") - означает что метод будет обрабатывать GET
                запросы связанные с url "file". Принимает токен аутентификации и имя файла в качестве параметров. 
                Вызывает метод скачивания файла из FileService и возвращает содержимое файла в виде массива байтов.


                  метод "listFiles" помечен аннотацией @GetMapping("/list") - означает что метод будет обрабатывать GET
                запросы связанные с url "file".Принимает токен аутентификации и вызывает метод для получения списка 
                файлов из FileService. Возвращает список файлов в формате JSON.


    
 6.   пакет "service" содержит 2 класса:


      - класс "FileService" помечен аннотацией "@Service"- указывает, что класс является сервисом и зарегистрирован в 
    контексте Spring. Класс  предназначен для работы с файлами, связанными с пользователями. Он предоставляет 
    функциональность для загрузки, удаления, скачивания и перечисления файлов. Класс использует логгер для записи 
    информации, предупреждений и ошибок в процессе работы сервиса.


                  метод "uploadFile" проверяет токен аутентификации и получает пользователя,создаёт директорию для загрузки, 
                если она не существует, сохраняет загруженный файл на диск и в базу данных, логирует успешную загрузку 
                или ошибку.

                
                  метод "deleteFile" проверяет токен аутентификации, находит файл, принадлежащий пользователю, и удаляет 
                его как с диска, так и из базы данных, логирует успешное удаление или предупреждение, если файл не найден.


                  метод "downloadFile" проверяет токен аутентификации, находит файл, принадлежащий пользователю, и 
                возвращает его содержимое в виде массива байтов, логирует ошибки, если файл не найден или возникает 
                проблема при чтении.


                  метод "listFiles" проверяет токен аутентификации, возвращает список файлов, загруженных пользователем.


                  метод "validateToken" проверяет, действителен ли токен аутентификации, и возвращает соответствующего 
                пользователя, логирует предупреждение в случае несанкционированного доступа.

      

      - класс "AuthorizationService" помечен аннотацией "@Service" - указывает, что класс является сервисом, который 
    будет управляться контейнером Spring. Класс отвечает за аутентификацию пользователей и управление токенами доступа. 
    Он предоставляет методы для входа и выхода из системы. В классе используется логгер для записи информации, предупреждений 
    и ошибок, связанных с аутентификацией пользователей.

                  

                  метод "authenticate" принимает логин и пароль пользователя,ищет пользователя по логину в базе данных. Если 
              пользователь не найден, выбрасывает исключение с сообщением "Неверный логин или пароль".Сравнивает введённый 
              пароль с хэшом пароля, хранящимся в базе данных, с помощью PasswordEncoder. Если пароли не совпадают, выбрасывает 
              исключение с тем же сообщением.Если аутентификация успешна, генерирует новый токен аутентификации и устанавливает 
              его для пользователя.Сохраняет обновлённого пользователя в базе данных и возвращает токен.


 
                  меетод "logout" принимает токен аутентификации для выхода из системы,ищет пользователя по токену в базе данных. 
              Если токен недействителен, выбрасывает исключение с сообщением о несанкционированном доступе и логирует предупреждение.
              Устанавливает токен пользователя в null, тем самым завершая сессию.Сохраняет обновлённого  пользователя в базе данных 
              и логирует успешный выход.
              
             
                  метод "generateAuthToken" генерирует уникальный токен аутентификации для пользователя. В данном случае 
                  используется UUID, но можно было бы использовать и другие методы генерации токенов, такие как JWT.























